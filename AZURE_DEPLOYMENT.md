# Azure PostgreSQL éƒ¨ç½²æŒ‡å—

## ç¬¬ä¸€æ­¥ï¼šåœ¨Azureåˆ›å»ºPostgreSQLæ•°æ®åº“

### 1. ç™»å½•Azure Portal
è®¿é—® https://portal.azure.com

### 2. åˆ›å»º Azure Database for PostgreSQL
1. ç‚¹å‡» **åˆ›å»ºèµ„æº**
2. æœç´¢ **Azure Database for PostgreSQL**
3. é€‰æ‹© **çµæ´»æœåŠ¡å™¨ (Flexible Server)** - æ¨èï¼Œæ€§ä»·æ¯”é«˜
4. å¡«å†™é…ç½®ï¼š
   - **è®¢é˜…**: é€‰æ‹©ä½ çš„è®¢é˜…
   - **èµ„æºç»„**: åˆ›å»ºæ–°çš„æˆ–é€‰æ‹©å·²æœ‰çš„
   - **æœåŠ¡å™¨åç§°**: `survey-forms-db` (æˆ–ä½ å–œæ¬¢çš„åå­—)
   - **åŒºåŸŸ**: é€‰æ‹©ç¦»ä½ æœ€è¿‘çš„åŒºåŸŸï¼ˆå¦‚ East Asiaï¼‰
   - **PostgreSQLç‰ˆæœ¬**: é€‰æ‹© 14 æˆ–æ›´é«˜ç‰ˆæœ¬
   - **è®¡ç®—+å­˜å‚¨**: 
     * é€‰æ‹© **å¯çªå‘** å±‚ï¼ˆB1msï¼Œ1æ ¸2GBï¼‰æœ€ä¾¿å®œ
     * æˆ– **å¸¸è§„ç”¨é€”** å±‚ç”¨äºç”Ÿäº§
   - **ç®¡ç†å‘˜ç”¨æˆ·å**: `adminuser` (è‡ªå®šä¹‰)
   - **å¯†ç **: è®¾ç½®å¼ºå¯†ç å¹¶è®°ä½

### 3. ç½‘ç»œé…ç½®
1. åœ¨ **ç½‘ç»œ** æ ‡ç­¾é¡µï¼š
   - è¿æ¥æ–¹æ³•ï¼šé€‰æ‹© **å…¬å…±è®¿é—®**
   - é˜²ç«å¢™è§„åˆ™ï¼š
     * å‹¾é€‰ **å…è®¸æ¥è‡ªAzureæœåŠ¡å’Œèµ„æºçš„å…¬å…±è®¿é—®**
     * æ·»åŠ ä½ å½“å‰çš„IPåœ°å€ï¼ˆç”¨äºæœ¬åœ°æµ‹è¯•ï¼‰
     * ç¨åå¯ä»¥æ·»åŠ æ›´å¤šIP

### 4. å®¡æ ¸å¹¶åˆ›å»º
- æ£€æŸ¥é…ç½®
- ç‚¹å‡» **åˆ›å»º**
- ç­‰å¾… 5-10 åˆ†é’Ÿéƒ¨ç½²å®Œæˆ

## ç¬¬äºŒæ­¥ï¼šé…ç½®æ•°æ®åº“

### 1. è·å–è¿æ¥ä¿¡æ¯
éƒ¨ç½²å®Œæˆåï¼š
1. è¿›å…¥åˆ›å»ºçš„PostgreSQLèµ„æº
2. ç‚¹å‡»å·¦ä¾§ **æ¦‚è¿°**
3. å¤åˆ¶ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **æœåŠ¡å™¨åç§°**: `survey-forms-db.postgres.database.azure.com`
   - **ç®¡ç†å‘˜ç”¨æˆ·å**: `adminuser`
   - **ç«¯å£**: `5432` (é»˜è®¤)

### 2. åˆ›å»ºæ•°æ®åº“
1. åœ¨å·¦ä¾§èœå•é€‰æ‹© **æ•°æ®åº“**
2. ç‚¹å‡» **+ æ·»åŠ **
3. æ•°æ®åº“åç§°è¾“å…¥: `survey_forms`
4. ç‚¹å‡» **ä¿å­˜**

## ç¬¬ä¸‰æ­¥ï¼šé…ç½®åº”ç”¨ç¨‹åº

### 1. æ›´æ–°åç«¯é…ç½®
åœ¨é¡¹ç›®çš„ `backend/.env` æ–‡ä»¶ä¸­å¡«å†™ï¼š

```env
# æ›¿æ¢ä¸ºä½ çš„å®é™…ä¿¡æ¯
DB_HOST=survey-forms-db.postgres.database.azure.com
DB_PORT=5432
DB_NAME=survey_forms
DB_USER=adminuser
DB_PASSWORD=ä½ çš„å¯†ç 
PORT=3000
```

### 2. æµ‹è¯•è¿æ¥
åœ¨åç«¯ç›®å½•è¿è¡Œï¼š
```bash
cd backend
npm start
```

å¦‚æœçœ‹åˆ° `Database initialized successfully` å’Œ `Server is running`ï¼Œè¯´æ˜è¿æ¥æˆåŠŸï¼

## ç¬¬å››æ­¥ï¼šå®‰å…¨é…ç½®ï¼ˆé‡è¦ï¼ï¼‰

### 1. é…ç½®SSL
- Azure PostgreSQLé»˜è®¤è¦æ±‚SSLè¿æ¥
- ä»£ç å·²é…ç½® `ssl: { rejectUnauthorized: false }`
- ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨è¯ä¹¦éªŒè¯

### 2. é˜²ç«å¢™è§„åˆ™
åœ¨Azure Portalä¸­ï¼š
1. è¿›å…¥PostgreSQLèµ„æº
2. ç‚¹å‡» **ç½‘ç»œ**
3. æ·»åŠ å…è®¸çš„IPåœ°å€ï¼š
   - ä½ çš„åŠå…¬ç½‘ç»œIP
   - åº”ç”¨æœåŠ¡å™¨çš„å‡ºç«™IPï¼ˆå¦‚æœéƒ¨ç½²åˆ°Azure App Serviceï¼‰
   - é¿å…ä½¿ç”¨ `0.0.0.0 - 255.255.255.255`ï¼ˆé™¤éæµ‹è¯•ï¼‰

### 3. ç¯å¢ƒå˜é‡å®‰å…¨
- **æ°¸è¿œä¸è¦**å°† `.env` æ–‡ä»¶æäº¤åˆ°Git
- `.env` å·²åœ¨ `.gitignore` ä¸­

## ç¬¬äº”æ­¥ï¼šæ•°æ®åº“ç®¡ç†å·¥å…·ï¼ˆå¯é€‰ï¼‰

### ä½¿ç”¨pgAdminè¿æ¥
1. ä¸‹è½½ pgAdmin: https://www.pgadmin.org/
2. æ·»åŠ æ–°æœåŠ¡å™¨ï¼š
   - ä¸»æœº: `survey-forms-db.postgres.database.azure.com`
   - ç«¯å£: `5432`
   - æ•°æ®åº“: `survey_forms`
   - ç”¨æˆ·å: `adminuser`
   - å¯†ç : ä½ çš„å¯†ç 
   - SSLæ¨¡å¼: Require

### ä½¿ç”¨Azure PortalæŸ¥è¯¢ç¼–è¾‘å™¨
1. åœ¨PostgreSQLèµ„æºä¸­ç‚¹å‡» **æŸ¥è¯¢ç¼–è¾‘å™¨**
2. ç™»å½•åå¯ä»¥ç›´æ¥æ‰§è¡ŒSQLæŸ¥è¯¢

## è´¹ç”¨ä¼°ç®—

### å¯çªå‘å±‚ (B1ms)
- 1 vCore, 2 GiB RAM
- 32 GiB å­˜å‚¨
- **çº¦ Â¥60-80/æœˆ**
- é€‚åˆå¼€å‘å’Œå°å‹åº”ç”¨

### å¸¸è§„ç”¨é€”å±‚ (D2s_v3)
- 2 vCore, 8 GiB RAM
- 128 GiB å­˜å‚¨
- **çº¦ Â¥600-800/æœˆ**
- é€‚åˆç”Ÿäº§ç¯å¢ƒ

### èŠ‚çœæˆæœ¬æŠ€å·§
- ä½¿ç”¨é¢„ç•™å®¹é‡å¯èŠ‚çœæœ€å¤š65%
- éå·¥ä½œæ—¶é—´å¯ä»¥åœæ­¢æœåŠ¡å™¨
- å®šæœŸæ¸…ç†æ—§æ•°æ®

## æ•…éšœæ’æŸ¥

### è¿æ¥è¶…æ—¶
- æ£€æŸ¥é˜²ç«å¢™è§„åˆ™æ˜¯å¦åŒ…å«ä½ çš„IP
- ç¡®è®¤æœåŠ¡å™¨çŠ¶æ€ä¸º"å¯ç”¨"
- æ£€æŸ¥.envé…ç½®æ˜¯å¦æ­£ç¡®

### SSLé”™è¯¯
- ç¡®ä¿ä»£ç ä¸­æœ‰ `ssl: { rejectUnauthorized: false }`
- æˆ–ä¸‹è½½SSLè¯ä¹¦å¹¶é…ç½®

### æƒé™é”™è¯¯
- ç¡®è®¤ç”¨æˆ·åæ ¼å¼æ­£ç¡®ï¼ˆä¸éœ€è¦ `@servername` åç¼€ï¼‰
- æ£€æŸ¥å¯†ç æ˜¯å¦æ­£ç¡®

## ç”Ÿäº§ç¯å¢ƒå»ºè®®

1. **å¤‡ä»½**: å¯ç”¨è‡ªåŠ¨å¤‡ä»½ï¼ˆ7-35å¤©ä¿ç•™æœŸï¼‰
2. **é«˜å¯ç”¨æ€§**: å¯ç”¨åŒºåŸŸå†—ä½™ï¼ˆå¦‚éœ€è¦ï¼‰
3. **ç›‘æ§**: é…ç½®Azure Monitorå‘Šè­¦
4. **æ€§èƒ½**: æ ¹æ®å®é™…ä½¿ç”¨è°ƒæ•´è®¡ç®—èµ„æº
5. **å®‰å…¨**: ä½¿ç”¨Azure Key Vaultå­˜å‚¨å¯†ç 

## è¿ç§»ç°æœ‰æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰

å¦‚æœä½ æœ‰SQLiteæ•°æ®éœ€è¦è¿ç§»ï¼š

```bash
# 1. å¯¼å‡ºSQLiteæ•°æ®ä¸ºSQL
sqlite3 survey.db .dump > backup.sql

# 2. è½¬æ¢ä¸ºPostgreSQLæ ¼å¼ï¼ˆéœ€è¦æ‰‹åŠ¨è°ƒæ•´ï¼‰
# 3. ä½¿ç”¨psqlå¯¼å…¥
psql -h survey-forms-db.postgres.database.azure.com -U adminuser -d survey_forms -f backup.sql
```

## ä¸‹ä¸€æ­¥

- éƒ¨ç½²å‰ç«¯åˆ°Azure Static Web Apps
- éƒ¨ç½²åç«¯åˆ°Azure App Service
- é…ç½®è‡ªå®šä¹‰åŸŸå
- è®¾ç½®CI/CDè‡ªåŠ¨éƒ¨ç½²

å®Œæˆï¼ä½ çš„åº”ç”¨ç°åœ¨ä½¿ç”¨Azure PostgreSQLæ•°æ®åº“äº† ğŸ‰
